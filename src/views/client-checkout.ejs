<!-- Start Content-->
<div class="container-fluid">

    <!-- Begin page -->
    <div class="wrapper">

        <div class="content-page">
            <div class="content">

                <!-- start page title -->
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box">
                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">Hyper</a></li>
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">eCommerce</a></li>
                                    <li class="breadcrumb-item active">Checkout</li>
                                </ol>
                            </div>
                            <h4 class="page-title">Checkout</h4>
                        </div>
                    </div>
                </div>
                <!-- end page title -->

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">

                                <!-- Checkout Steps -->
                                <ul class="nav nav-pills bg-nav-pills nav-justified mb-3">
                                    <li class="nav-item">
                                        <a href="#shipping-information" data-toggle="tab" aria-expanded="true"
                                           class="nav-link rounded-0 active" id="btn-shipping">
                                            <i class="mdi mdi-truck-fast font-18"></i>
                                            <span class="d-none d-lg-block">Shipping Info</span>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="#payment-information" data-toggle="tab" aria-expanded="false"
                                           class="nav-link rounded-0" id="btn-payment">
                                            <i class="mdi mdi-cash-multiple font-18"></i>
                                            <span class="d-none d-lg-block">Payment Info</span>
                                        </a>
                                    </li>
                                </ul>

                                <!-- Steps Information -->
                                <div class="tab-content">

                                    <!-- Shipping Content-->
                                    <div class="tab-pane show active" id="shipping-information">
                                        <div class="row">
                                            <div class="col-lg-8">
                                                <h4>Shipping info</h4>

                                                <p class="text-muted mb-4">Please check or fill out necessary information
                                                        before proceeding to the next step.</p>

                                                <form>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label for="input-fullname">Full name <span
                                                                            class="text-danger">*</span></label>
                                                                <input class="form-control" type="text"
                                                                       placeholder="Enter your name" value="<%= data.userInfo.fullname %>"
                                                                       id="input-fullname" required/>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label for="input-phone">Phone <span
                                                                            class="text-danger">*</span></label>
                                                                <input class="form-control" type="text"
                                                                       placeholder="(xx) xxx xxxx xxx" value="<%= data.userInfo.phone %>"
                                                                       id="input-phone" required/>
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <div class="form-group">
                                                                <label for="input-address">Address <span
                                                                            class="text-danger">*</span></label>
                                                                <input class="form-control" type="text"
                                                                       placeholder="Enter full address" value="<%= data.userInfo.address %>"
                                                                       id="input-address" required>
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->

                                                    <div class="row">
                                                        <div class="col-12">
                                                            <div class="form-group text-right">
                                                                <button class="btn btn-primary" id="btn-saveChange"  data-toggle="modal" data-target="#update-modal">
                                                                    <i class="mdi mdi-account-edit-outline"></i> Save changes
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <h4 class="mt-4">Shipping Method</h4>

                                                    <p class="text-muted">Fill the form below in order to
                                                        send you the order's invoice.</p>

                                                    <div id="shipping-method-show">
                                                    <% let checkCloseDiv = 0; data.typeTransports.forEach((ele, i) => { checkCloseDiv = i; %>

                                                        <% if (i % 2 === 0) { %> <div class="row mt-3"> <% } %>
                                                            <div class="col-md-6">
                                                                <div class="border p-3 rounded mb-3 mb-md-0">
                                                                    <div class="custom-control custom-radio">
                                                                        <input type="radio" id="<%= ele._id %>"
                                                                               name="shippingOptions" data="<%= ele.price %>"
                                                                               class="custom-control-input" <%= i === 0 ? "checked" : "" %>>
                                                                        <label class="custom-control-label font-16 font-weight-bold"
                                                                               for="<%= ele._id %>"><%= ele.name %> -
                                                                            <%= ele.price.toLocaleString() %> Ä‘</label>
                                                                    </div>
                                                                    <p class="mb-0 pl-3 pt-1"><%= ele.description %></p>
                                                                </div>
                                                            </div>
                                                            <% if (i % 2 !== 0) { %> </div> <% } %>
                                                    <% }) %>
                                                    <% if (checkCloseDiv % 2 === 0) { %> </div> <% } %>
                                                    </div>
                                                    <!-- end row-->

                                                    <div class="row mt-4">
                                                        <div class="col-sm-6">
                                                            <a href="/cart"
                                                               class="btn text-muted d-none d-sm-inline-block btn-link font-weight-semibold">
                                                                <i class="mdi mdi-arrow-left"></i> Back to Shopping Cart
                                                            </a>
                                                        </div> <!-- end col -->
                                                        <div class="col-sm-6">
                                                            <div class="text-sm-right">
                                                                <a href="#payment-information" data-toggle="tab" aria-expanded="false"
                                                                   class="btn btn-danger" id="btn-continue">
                                                                    <i class="mdi mdi-cash-multiple mr-1"></i> Continue
                                                                    to Payment </a>
                                                            </div>
                                                        </div> <!-- end col -->
                                                    </div> <!-- end row -->
                                                </form>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="border p-3 mt-4 mt-lg-0 rounded">
                                                    <h4 class="header-title mb-3">Order Summary</h4>

                                                    <div class="table-responsive">
                                                        <table class="table table-centered mb-0">
                                                            <tbody id="summary-1">
                                                            <tr>
                                                                <td>
                                                                    <img src="/public/assets/images/products/product-1.jpg"
                                                                         alt="contact-img"
                                                                         title="contact-img" class="rounded mr-2"
                                                                         height="48"/>
                                                                    <p class="m-0 d-inline-block align-middle">
                                                                        <a href="apps-ecommerce-products-details.html"
                                                                           class="text-body font-weight-semibold">Amazing
                                                                            Modern Chair</a>
                                                                        <br>
                                                                        <small>5 x $148.66</small>
                                                                    </p>
                                                                </td>
                                                                <td class="text-right">
                                                                    $743.30
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <img src="/public/assets/images/products/product-2.jpg"
                                                                         alt="contact-img"
                                                                         title="contact-img" class="rounded mr-2"
                                                                         height="48"/>
                                                                    <p class="m-0 d-inline-block align-middle">
                                                                        <a href="apps-ecommerce-products-details.html"
                                                                           class="text-body font-weight-semibold">Designer
                                                                            Awesome Chair</a>
                                                                        <br>
                                                                        <small>2 x $99.00</small>
                                                                    </p>
                                                                </td>
                                                                <td class="text-right">
                                                                    $198.00
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <img src="/public/assets/images/products/product-3.jpg"
                                                                         alt="contact-img"
                                                                         title="contact-img" class="rounded mr-2"
                                                                         height="48"/>
                                                                    <p class="m-0 d-inline-block align-middle">
                                                                        <a href="apps-ecommerce-products-details.html"
                                                                           class="text-body font-weight-semibold">Biblio
                                                                            Plastic Armchair</a>
                                                                        <br>
                                                                        <small>1 x $129.99</small>
                                                                    </p>
                                                                </td>
                                                                <td class="text-right">
                                                                    $129.99
                                                                </td>
                                                            </tr>
                                                            <tr class="text-right">
                                                                <td>
                                                                    <h6 class="m-0">Sub Total:</h6>
                                                                </td>
                                                                <td class="text-right">
                                                                    $1071.29
                                                                </td>
                                                            </tr>
                                                            <tr class="text-right">
                                                                <td>
                                                                    <h6 class="m-0">Shipping:</h6>
                                                                </td>
                                                                <td class="text-right">
                                                                    FREE
                                                                </td>
                                                            </tr>
                                                            <tr class="text-right">
                                                                <td>
                                                                    <h5 class="m-0">Total:</h5>
                                                                </td>
                                                                <td class="text-right font-weight-semibold">
                                                                    $1071.29
                                                                </td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <!-- end table-responsive -->
                                                </div> <!-- end .border-->

                                            </div> <!-- end col -->
                                        </div> <!-- end row-->
                                    </div>
                                    <!-- End Shipping Information Content-->

                                    <!-- Payment Content-->
                                    <div class="tab-pane" id="payment-information">
                                        <div class="row">

                                            <div class="col-lg-8">
                                                <h4 class="mt-2">Payment Selection</h4>

                                                <p class="text-muted mb-4">Fill the form below in order to
                                                    send you the order's invoice.</p>

                                                <!-- Pay with Paypal box-->
                                                <div class="border p-3 mb-3 rounded">
                                                    <div class="row">
                                                        <div class="col-sm-8">
                                                            <div class="custom-control custom-radio">
                                                                <input type="radio" id="BillingOptRadio2"
                                                                       name="billingOptions"
                                                                       class="custom-control-input">
                                                                <label class="custom-control-label font-16 font-weight-bold"
                                                                       for="BillingOptRadio2">Pay with Paypal</label>
                                                            </div>
                                                            <p class="mb-0 pl-3 pt-1">You will be redirected to PayPal
                                                                website to complete your purchase securely.</p>
                                                        </div>
                                                        <div class="col-sm-4 text-sm-right mt-3 mt-sm-0">
                                                            <img src="/public/assets/images/payments/paypal.png" height="25"
                                                                 alt="paypal-img">
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- end Pay with Paypal box-->

                                                <!-- Credit/Debit Card box-->
                                                <div class="border p-3 mb-3 rounded">
                                                    <div class="row">
                                                        <div class="col-sm-8">
                                                            <div class="custom-control custom-radio">
                                                                <input type="radio" id="BillingOptRadio1"
                                                                       name="billingOptions"
                                                                       class="custom-control-input" checked>
                                                                <label class="custom-control-label font-16 font-weight-bold"
                                                                       for="BillingOptRadio1">Credit / Debit
                                                                    Card</label>
                                                            </div>
                                                            <p class="mb-0 pl-3 pt-1">Safe money transfer using your
                                                                bank account. We support Mastercard, Visa, Discover and
                                                                Stripe.</p>
                                                        </div>
                                                        <div class="col-sm-4 text-sm-right mt-3 mt-sm-0">
                                                            <img src="/public/assets/images/payments/master.png" height="24"
                                                                 alt="master-card-img">
                                                            <img src="/public/assets/images/payments/discover.png" height="24"
                                                                 alt="discover-card-img">
                                                            <img src="/public/assets/images/payments/visa.png" height="24"
                                                                 alt="visa-card-img">
                                                            <img src="/public/assets/images/payments/stripe.png" height="24"
                                                                 alt="stripe-card-img">
                                                        </div>
                                                    </div> <!-- end row -->
                                                    <div class="row mt-4">
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                                <label for="card-number">Card Number</label>
                                                                <input type="text" id="card-number" class="form-control"
                                                                       data-toggle="input-mask"
                                                                       data-mask-format="0000 0000 0000 0000"
                                                                       placeholder="4242 4242 4242 4242">
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label for="card-name-on">Name on card</label>
                                                                <input type="text" id="card-name-on"
                                                                       class="form-control" placeholder="Master Shreyu">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-group">
                                                                <label for="card-expiry-date">Expiry date</label>
                                                                <input type="text" id="card-expiry-date"
                                                                       class="form-control" data-toggle="input-mask"
                                                                       data-mask-format="00/00" placeholder="MM/YY">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-group">
                                                                <label for="card-cvv">CVV code</label>
                                                                <input type="text" id="card-cvv" class="form-control"
                                                                       data-toggle="input-mask" data-mask-format="000"
                                                                       placeholder="012">
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->
                                                </div>
                                                <!-- end Credit/Debit Card box-->

                                                <!-- Pay with Payoneer box-->
                                                <div class="border p-3 mb-3 rounded">
                                                    <div class="row">
                                                        <div class="col-sm-8">
                                                            <div class="custom-control custom-radio">
                                                                <input type="radio" id="BillingOptRadio3"
                                                                       name="billingOptions"
                                                                       class="custom-control-input">
                                                                <label class="custom-control-label font-16 font-weight-bold"
                                                                       for="BillingOptRadio3">Pay with Payoneer</label>
                                                            </div>
                                                            <p class="mb-0 pl-3 pt-1">You will be redirected to Payoneer
                                                                website to complete your purchase securely.</p>
                                                        </div>
                                                        <div class="col-sm-4 text-sm-right mt-3 mt-sm-0">
                                                            <img src="/public/assets/images/payments/payoneer.png" height="30"
                                                                 alt="paypal-img">
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- end Pay with Payoneer box-->

                                                <!-- Cash on Delivery box-->
                                                <div class="border p-3 mb-3 rounded">
                                                    <div class="row">
                                                        <div class="col-sm-8">
                                                            <div class="custom-control custom-radio">
                                                                <input type="radio" id="BillingOptRadio4"
                                                                       name="billingOptions"
                                                                       class="custom-control-input">
                                                                <label class="custom-control-label font-16 font-weight-bold"
                                                                       for="BillingOptRadio4">Cash on Delivery</label>
                                                            </div>
                                                            <p class="mb-0 pl-3 pt-1">Pay with cash when your order is
                                                                delivered.</p>
                                                        </div>
                                                        <div class="col-sm-4 text-sm-right mt-3 mt-sm-0">
                                                            <img src="/public/assets/images/payments/cod.png" height="22"
                                                                 alt="paypal-img">
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- end Cash on Delivery box-->

                                                <div class="row mt-4">
                                                    <div class="col-sm-6">
                                                        <a href="#shipping-information" data-toggle="tab" aria-expanded="false"
                                                           class="btn text-muted d-none d-sm-inline-block btn-link font-weight-semibold" id="btn-backShipping">
                                                            <i class="mdi mdi-arrow-left"></i> Back to Shopping Info
                                                        </a>
                                                    </div> <!-- end col -->
                                                    <div class="col-sm-6">
                                                        <div class="text-sm-right">
                                                            <a href="apps-ecommerce-checkout.html"
                                                               class="btn btn-danger">
                                                                <i class="mdi mdi-cash-multiple mr-1"></i> Complete
                                                                Order </a>
                                                        </div>
                                                    </div> <!-- end col -->
                                                </div> <!-- end row-->

                                            </div> <!-- end col -->

                                            <div class="col-lg-4">
                                                <div class="border p-3 mt-4 mt-lg-0 rounded">
                                                    <h4 class="header-title mb-3">Order Summary</h4>

                                                    <div class="table-responsive">
                                                        <table class="table table-centered mb-0">
                                                            <tbody id="summary-2">
                                                            <tr>
                                                                <td>
                                                                    <img src="/public/assets/images/products/product-1.jpg"
                                                                         alt="contact-img"
                                                                         title="contact-img" class="rounded mr-2"
                                                                         height="48"/>
                                                                    <p class="m-0 d-inline-block align-middle">
                                                                        <a href="apps-ecommerce-products-details.html"
                                                                           class="text-body font-weight-semibold">Amazing
                                                                            Modern Chair</a>
                                                                        <br>
                                                                        <small>5 x $148.66</small>
                                                                    </p>
                                                                </td>
                                                                <td class="text-right">
                                                                    $743.30
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <img src="/public/assets/images/products/product-2.jpg"
                                                                         alt="contact-img"
                                                                         title="contact-img" class="rounded mr-2"
                                                                         height="48"/>
                                                                    <p class="m-0 d-inline-block align-middle">
                                                                        <a href="apps-ecommerce-products-details.html"
                                                                           class="text-body font-weight-semibold">Designer
                                                                            Awesome Chair</a>
                                                                        <br>
                                                                        <small>2 x $99.00</small>
                                                                    </p>
                                                                </td>
                                                                <td class="text-right">
                                                                    $198.00
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <img src="/public/assets/images/products/product-3.jpg"
                                                                         alt="contact-img"
                                                                         title="contact-img" class="rounded mr-2"
                                                                         height="48"/>
                                                                    <p class="m-0 d-inline-block align-middle">
                                                                        <a href="apps-ecommerce-products-details.html"
                                                                           class="text-body font-weight-semibold">Biblio
                                                                            Plastic Armchair</a>
                                                                        <br>
                                                                        <small>1 x $129.99</small>
                                                                    </p>
                                                                </td>
                                                                <td class="text-right">
                                                                    $129.99
                                                                </td>
                                                            </tr>
                                                            <tr class="text-right">
                                                                <td>
                                                                    <h6 class="m-0">Sub Total:</h6>
                                                                </td>
                                                                <td class="text-right">
                                                                    $1071.29
                                                                </td>
                                                            </tr>
                                                            <tr class="text-right">
                                                                <td>
                                                                    <h6 class="m-0">Shipping:</h6>
                                                                </td>
                                                                <td class="text-right">
                                                                    FREE
                                                                </td>
                                                            </tr>
                                                            <tr class="text-right">
                                                                <td>
                                                                    <h5 class="m-0">Total:</h5>
                                                                </td>
                                                                <td class="text-right font-weight-semibold">
                                                                    $1071.29
                                                                </td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <!-- end table-responsive -->
                                                </div> <!-- end .border-->

                                            </div> <!-- end col -->
                                        </div> <!-- end row-->
                                    </div>
                                    <!-- End Payment Information Content-->

                                </div> <!-- end tab content-->

                            </div> <!-- end card-body-->
                        </div> <!-- end card-->
                    </div> <!-- end col -->
                </div>
                <!-- end row-->

            </div> <!-- End Content -->

            <!-- Footer Start -->
            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-6">
                            2018 - 2020 Â© Hyper - Coderthemes.com
                        </div>
                        <div class="col-md-6">
                            <div class="text-md-right footer-links d-none d-md-block">
                                <a href="javascript: void(0);">About</a>
                                <a href="javascript: void(0);">Support</a>
                                <a href="javascript: void(0);">Contact Us</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
            <!-- end Footer -->

        </div> <!-- content-page -->

    </div> <!-- end wrapper-->
</div>
<!-- END Container -->

<!-- Modal ask before save changes -->
<div id="update-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="warning-header-modalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header modal-colored-header bg-warning">
                <h4 class="modal-title" id="warning-header-modalLabel">Save changes?</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
            </div>
            <div class="modal-body">
                Are you sure to update your information ?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-warning" id="btn-save" data-dismiss="modal">Continue</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<%- contentFor('js') %>
<script>
    let data = [];
    $(document).ready(function () {
        btnSwitchTab();
        getOrderSummary();
    })

    $(document).on("click", "#shipping-method-show input", function (e) {
        renderSummary();
    })

    $("#btn-saveChange").click(function (e) {
        e.preventDefault();
    })

    $("#btn-save").click(function (e) {
        const fullname = $("#input-fullname").val();
        const phone = $("#input-phone").val();
        const address = $("#input-address").val();

        if (!fullname || !phone || !address)
            return $.NotificationApp.send("Warning", `Please fill out all fields before save!`, "top-right", "rgba(0,0,0,0.2)", "warning");

        $.ajax({
            url: "/api/user/update-info",
            method: "put",
            data: {
                fullname,
                phone,
                address
            },
            success: (response) => {
                if (response.status) {
                    return $.NotificationApp.send("Success", `Updated your information!`, "top-right", "rgba(0,0,0,0.2)", "success");
                }
            },
            error: (err) => {
                return $.NotificationApp.send("Error", `Error when updating your information!`, "top-right", "rgba(0,0,0,0.2)", "error");
            }
        })
    })

    function renderSummary() {
        let render = ``;
        let subTotal = 0;
        let shippingFee = getShippingFee();
        data.forEach(ele => {
            let nameParams = ele.product[0].name.split("");
            let name = ele.product[0].name;
            if (nameParams.length > 20) name = nameParams.slice(0, 20).join("") + " ...";
            let totalPerOne = ele.product[0].price * ele.amount;
            subTotal += totalPerOne;
            render += `
            <tr>
                <td>
                    <img src="/public/resources/images/${ele.product[0].image}" alt="contact-img" title="contact-img" class="rounded mr-2" height="48">
                    <p class="m-0 d-inline-block align-middle">
                        <a href="/product/${ele.product[0]._id}" class="text-body font-weight-semibold"
                             data-toggle="tooltip" data-placement="top" data-original-title="${ele.product[0].name}">${name}</a>
                        <br>
                        <small>${ele.amount.toLocaleString()} x ${ele.product[0].price.toLocaleString()} Ä‘</small>
                    </p>
                </td>
                <td class="text-right">
                    ${totalPerOne.toLocaleString()} Ä‘
                </td>
            </tr>`;
        });
        render += `
                    <tr class="text-right">
                        <td>
                            <h6 class="m-0">Sub Total:</h6>
                        </td>
                        <td class="text-right">
                            ${subTotal.toLocaleString()} Ä‘
                        </td>
                    </tr>
                    <tr class="text-right">
                        <td>
                            <h6 class="m-0">Shipping fee:</h6>
                        </td>
                        <td class="text-right">
                            ${shippingFee.toLocaleString()} Ä‘
                        </td>
                    </tr>
                    <tr class="text-right">
                        <td>
                            <h6 class="m-0">Sub Total:</h6>
                        </td>
                        <td class="text-right">
                            ${(subTotal+shippingFee).toLocaleString()} Ä‘
                        </td>
                    </tr>`;
        $("#summary-1").html(render);
        $("#summary-2").html(render);
        $('[data-toggle="tooltip"]').tooltip();
    }

    function getOrderSummary() {
        $.ajax({
            url: "/api/cart/<%= data.user._id %>",
            method: "get",
            success: (response) => {
                if (response.status) {
                    data = response.data;
                    renderSummary()
                }
            },
            error: (err) => {

            }
        })
    }

    function getShippingFee() {
        const input = $("#shipping-method-show").find("input:checked");
        return +input.attr("data");
    }

    function btnSwitchTab() {
        const btnShipping = $("#btn-shipping");
        const btnPayment = $("#btn-payment");
        const btnContinue = $("#btn-continue");
        const btnBackShipping = $("#btn-backShipping");

        btnContinue.click(function (e) {
            btnContinue.removeClass("active");
            btnShipping.removeClass("active");
            btnPayment.addClass("active");
        })

        btnBackShipping.click(function (e) {
            btnBackShipping.removeClass("active");
            btnPayment.removeClass("active");
            btnShipping.addClass("active");
        })
    }
</script>